"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),CONFIG={gameLoopInterval:16,map:{height:200,width:100},textures:{dirt:"dirt.png"},types:{dirt:{solid:!0,"static":!0,size:{height:100,width:100}}}},V=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],i=arguments.length<=1||void 0===arguments[1]?0:arguments[1];_classCallCheck(this,t),this.x=e,this.y=i}return _createClass(t,[{key:"add",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t(0,0):arguments[0];return new t(e.x+this.x,e.y+this.y)}},{key:"subtract",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t(0,0):arguments[0];return new t(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return new t(this.x*e,this.y*e)}},{key:"dot",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t(0,0):arguments[0];return this.x*e.x+this.y*e.y}},{key:"cross",value:function(){var e=arguments.length<=0||void 0===arguments[0]?new t(0,0):arguments[0];return this.x*e.y-this.y*e.x}},{key:"rotate",value:function(e,i){var n=this.x-i.x,s=this.y-i.y,o=i.x+(n*Math.cos(e)-s*Math.sin(e)),r=i.y+(n*Math.sin(e)+s*Math.cos(e));return new t(o,r)}}]),t}(),Game=function(){function t(e){_classCallCheck(this,t),this.config=e,this.Map=function(){function t(e){_classCallCheck(this,t),this.width=e.width,this.height=e.height,this.entitys=[]}return _createClass(t,[{key:"addEntity",value:function(t){this.entitys.push(t)}}]),t}(),this.Entity=function(){function t(e){var i=e.positionX,n=void 0===i?0:i,s=e.positionY,o=void 0===s?0:s,r=e.centerX,a=void 0===r?0:r,h=e.centerY,c=void 0===h?0:h,l=e.angle,d=void 0===l?0:l,u=e.texture,v=void 0===u?0:u,y=e.height,p=void 0===y?0:y,g=e.width,x=void 0===g?0:g,f=e.hitbox,w=void 0===f?0:f,m=e.solid,k=void 0===m?!1:m,b=e["static"],C=void 0===b?!1:b;_classCallCheck(this,t),this.position=new V(n,o),this.linearVelocity=new V(0,0),this.force=new V(0,0),this.center=new V(a,c),this.angle=d,this.angularVelocity=0,this.torque=0,this.collision=!1,this.texture=v,this.height=p,this.width=x,this.hitbox=w,this.solid=k,this["static"]=C}return _createClass(t,[{key:"checkCollision",value:function(t){for(var e=this.hitbox[0].add(this.position),i=1;i<this.hitbox.length;i++){var n=this.hitbox[i].add(this.position),s=n.subtract(e),o=s.y/s.x;console.log(o);for(var r=t.hitbox[0].add(t.position),a=r.y*o,h=a<e.x,c=1;c<t.hitbox.length;c++){var l=t.hitbox[i].add(t.position),d=(l.y*o,a<l.x);if(h!=d)return!0;h=d}}return!1}},{key:"calculateCenter",value:function(){return new V}},{key:"applyForce",value:function(){}}]),t}(),this.map=new this.Map(this.config.map);var i=new Image;i.src="assets/images/dirt.png",this.map.addEntity(new this.Entity({positionX:0,positionY:0,texture:i,angle:0,centerX:10,centerY:10,height:20,width:20,hitbox:[new V(0,0),new V(20,0),new V(0,20)],solid:!0,"static":!0})),this.map.addEntity(new this.Entity({positionX:50,positionY:50,texture:i,angle:0,centerX:10,centerY:10,height:20,width:20,hitbox:[new V(0,0),new V(20,0),new V(0,20)],solid:!0,"static":!0})),this.expectedInterval=window.performance.now()+this.config.gameLoopInterval,setTimeout(this.gameLoop.bind(this),this.config.gameLoopInterval)}return _createClass(t,[{key:"input",value:function(){}},{key:"gameLoop",value:function(){this.input();var t=window.performance.now()-this.expectedInterval;t>this.config.gameLoopInterval&&(this.overtimeError(t),this.expectedInterval=window.performance.now());for(var e=(t+this.config.gameLoopInterval,0);e<this.map.entitys.length;e++)for(var i=this.map.entitys[e],n=0;n<this.map.entitys.length;n++){var s=this.map.entitys[n];i!=s&&i.checkCollision(s)&&(i.collision=!0)}this.expectedInterval+=this.config.gameLoopInterval,setTimeout(this.gameLoop.bind(this),this.config.gameLoopInterval-t)}},{key:"overtimeError",value:function(t){console.error("overtimeError: "+t)}}]),t}(),Render=function(){function t(e,i,n){_classCallCheck(this,t),this.canvas=document.createElement("canvas"),this.canvas.height=e.map.height,this.canvas.width=e.map.width,i.appendChild(this.canvas),this.canvas.style.imageRendering="pixelated",this.ctx=this.canvas.getContext("2d"),this.game=e,this.debugging=n,e.Entity.prototype.renderCenter=function(t){t.rect(0,0,1,1),t.fillStyle="red",t.fill()},e.Entity.prototype.renderHitbox=function(t){this.position.x,this.position.y;t.beginPath(),t.moveTo(this.hitbox[0].x-this.center.x,this.hitbox[0].y-this.center.y);for(var e=0;e<this.hitbox.length;e++){var i=this.hitbox[e];t.lineTo(i.x-this.center.x,i.y-this.center.y),t.moveTo(i.x-this.center.x,i.y-this.center.y)}t.lineTo(this.hitbox[0].x-this.center.x,this.hitbox[0].y-this.center.y),this.collision&&(t.strokeStyle="#ff0000"),t.stroke()},e.Entity.prototype.renderTexture=function(t){var e=(this.position.x,this.position.y,this.height),i=this.width;t.drawImage(this.texture,0-this.center.x,0-this.center.y,e,i)},setInterval(this.render.bind(this),Math.round(1e3/60))}return _createClass(t,[{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<game.map.entitys.length;t++){this.ctx.save();var e=game.map.entitys[t];this.transformContent(this.ctx,e),e.renderTexture(this.ctx),e.renderCenter(this.ctx),this.debugging.renderHitbox&&e.renderHitbox(this.ctx),this.ctx.restore()}}},{key:"transformContent",value:function(t,e){var i=e.position.x,n=e.position.y,s=e.angle;t.translate(i+e.center.x,n+e.center.y),t.rotate(s)}}]),t}(),Input=function t(e){var i=this;_classCallCheck(this,t),this.game=e,this.keys={w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowLeft:!1,ArrowDown:!1,ArrowRigth:!1};var n=this.keys;this.game.__proto__.input=function(){var t=new V(0,0);n.w&&t.y--,n.a&&t.x--,n.s&&t.y++,n.d&&t.x++,this.map.entitys[0].position=this.map.entitys[0].position.add(t)},window.addEventListener("keydown",function(t){i.keys.hasOwnProperty(t.key)&&(i.keys[t.key]=!0,t.preventDefault())}),window.addEventListener("keyup",function(t){i.keys.hasOwnProperty(t.key)&&(i.keys[t.key]=!1,t.preventDefault())})},game=new Game(CONFIG),input=new Input(game);document.addEventListener("DOMContentLoaded",function(){new Render(game,document.body,{renderHitbox:!0})});