"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),CONFIG={gameLoopInterval:16,map:{height:1e3,width:1e3},textures:{dirt:"dirt.png"},types:{dirt:{solid:!0,"static":!0,size:{height:100,width:100}}}},V=function(){function t(e,i){_classCallCheck(this,t),this.x=e,this.y=i}return _createClass(t,[{key:"add",value:function(e){return new t(e.x+this.x,e.y+this.y)}},{key:"subtract",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"rotate",value:function(e,i){var n=this.x-i.x,s=this.y-i.y,o=i.x+(n*Math.cos(e)-s*Math.sin(e)),r=i.y+(n*Math.sin(e)+s*Math.cos(e));return new t(o,r)}}]),t}(),Shape=function(){function t(){_classCallCheck(this,t),this.position=new V(0,0)}return _createClass(t,[{key:"checkCollision",value:function(t){}}]),t}(),Circle=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,y));return t.center=new V(0,0),t.radius=0,t}return _inherits(e,t),e}(Shape),Rectangle=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,y));return t.max=new V(0,0),t._rotation=0,t}return _inherits(e,t),_createClass(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t}}]),e}(Shape),Game=function(){function t(e){_classCallCheck(this,t),this.config=e,this.Map=function(){function t(e){_classCallCheck(this,t),this.width=e.width,this.height=e.height,this.entitys=[]}return _createClass(t,[{key:"addEntity",value:function(t){this.entitys.push(t)}}]),t}(),this.Entity=function(){function t(e){var i=e.positionX,n=void 0===i?0:i,s=e.positionY,o=void 0===s?0:s,r=e.sizeX,a=void 0===r?10:r,c=e.sizeY,h=void 0===c?10:c,l=e.texture,u=void 0===l?0:l,p=e.solid,y=void 0===p?!1:p,f=e["static"],d=void 0===f?!1:f;_classCallCheck(this,t),this.position=new V(n,o),this.velocity=new V(0,0),this.force=new V(0,0),this.size=new V(a,h),this.angle=0,this.center=new V(0,0),this.texture=u,this.solid=y,this["static"]=d}return _createClass(t,[{key:"checkCollision",value:function(t){return this.position.x<t.position.x+t.size.x&&this.position.x+this.size.x>t.position.x&&this.position.y<t.position.y+t.size.y&&this.position.y+this.size.x>t.position.y}}]),t}(),this.map=new this.Map(this.config.map);var i=new Image;i.src="assets/images/dirt.png",this.map.addEntity(new this.Entity({positionX:50,positionY:50,sizeX:16,sizeY:16,texture:i,solid:!0,"static":!1})),this.map.addEntity(new this.Entity({positionX:50,positionY:50,sizeX:16,sizeY:16,texture:i,solid:!0,"static":!1})),this.expectedInterval=window.performance.now()+this.config.gameLoopInterval,setTimeout(this.gameLoop.bind(this),this.config.gameLoopInterval)}return _createClass(t,[{key:"gameLoop",value:function(){this.specialInput();var t=window.performance.now()-this.expectedInterval;t>this.config.gameLoopInterval&&(this.overtimeError(t),this.expectedInterval=window.performance.now());for(var e=(t+this.config.gameLoopInterval)/1e3,i=0;i<this.map.entitys.length;i++){var n=this.map.entitys[i];if(!n["static"]){var s=n.force.scale(2e3);n.velocity=n.velocity.add(s.scale(e)).scale(.92),n.position=n.position.add(n.velocity.scale(e));for(var o=0;o<this.map.entitys.length;o++){var r=this.map.entitys[o];n!=r&&n.solid&&console.log(n.checkCollision(r))}}}this.expectedInterval+=this.config.gameLoopInterval,setTimeout(this.gameLoop.bind(this),this.config.gameLoopInterval-t)}},{key:"overtimeError",value:function(t){console.error("overtimeError: "+t)}},{key:"specialInput",value:function(){}}]),t}(),Render=function(){function t(e,i,n){_classCallCheck(this,t),this.canvas=document.createElement("canvas"),this.canvas.height=e.map.height,this.canvas.width=e.map.width,i.appendChild(this.canvas),this.canvas.style.imageRendering="pixelated",this.ctx=this.canvas.getContext("2d"),this.game=e,this.debugging=n,e.Entity.prototype.renderTexture=function(t){t.save(),t.translate(this.position.x+this.center.x,this.position.y+this.center.y),t.rotate(this.angle),t.drawImage(this.texture,0-this.center.x,0-this.center.y,this.size.x,this.size.y),t.restore()},setInterval(this.render.bind(this),Math.round(1e3/60))}return _createClass(t,[{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<game.map.entitys.length;t++){var e=game.map.entitys[t];e.renderTexture(this.ctx)}}}]),t}(),Input=function t(e){var i=this;_classCallCheck(this,t),this.game=e,this.keys={w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowLeft:!1,ArrowDown:!1,ArrowRigth:!1};var n=this.keys;e.__proto__.specialInput=function(){var t=new V(0,0);n.w&&t.y--,n.a&&t.x--,n.s&&t.y++,n.d&&t.x++,this.map.entitys[0].force=t},window.addEventListener("keydown",function(t){i.keys.hasOwnProperty(t.key)&&(i.keys[t.key]=!0,t.preventDefault())}),window.addEventListener("keyup",function(t){i.keys.hasOwnProperty(t.key)&&(i.keys[t.key]=!1,t.preventDefault())})},Communicator=function e(t){var i=this;_classCallCheck(this,e),this.game=t,t.__proto__.overtimeError=function(t){i.expectedInterval=window.performance.now()}},game=new Game(CONFIG),input=new Input(game),communicator=new Communicator(game,input);document.addEventListener("DOMContentLoaded",function(){new Render(game,document.body,{renderHitbox:!0})});